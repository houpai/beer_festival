<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/verifyResultDetail.css">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_1805932_ysrcp4y0uy9.css">
    <link rel="stylesheet" href="../iconfont/iconfont.css">
    <script src="../js/fontsize.js"></script>
    <script src="../js/jquery-1.8.3.min.js"></script>
</head>
<body>
<div class="verifyResultDetail_container">
    <div class="result_box">
        <div class="result_box_container">
            <div class="result_message_box">
                <p class="result_title no_pass">审核未通过</p>
                <p class="result_sub_title">失败原因：照片不合格！</p>
                <p class="time">申请时间：2020.09.09 10:10</p>
            </div>
            <img src="../images/pass.png" alt="" class="result_img">
        </div>
    </div>

    <h4 class="update_title">修改信息</h4>
    <!--    此处回显input 设置只读即可，图片回显详情见字符串 样式已写好，需要注意不再需要垃圾桶样式的删除图片按钮-->
    <div class="form_box upload-content">
        <p class="label_title">
            真实姓名
        </p>
        <input type="text"/>
        <p class="label_title">
            身份证号
        </p>
        <input type="text"/>
        <p class="label_title">
            本人照片
        </p>
        <div class="upload_box content-img">
            <ul class="content-img-list"></ul>
            <div class="file">
                <i class="gcl gcladd"></i>
                <input type="file" name="file" accept="image/*" id="upload">
            </div>
            <p class="upload_desc">
                请上传公民本人正面免冠彩色头像，头部占照片尺寸的2/3，无边框，人像清晰，无变形。本照片将用于“志愿者证”的正面，请认真上传。
            </p>
        </div>
    </div>

    <!--    回显没有按钮 加上hide class 即可-->
    <!--    <div class="submit_btn hide">-->
    <!--      提交-->
    <!--    </div>-->
    <div class="submit_btn">
        提交
    </div>

</div>
</body>

<script>
    var imgFile = []; //文件流
    var imgSrc = []; //图片路径
    var imgName = []; //图片名字
    $(function () {

        // 鼠标经过显示删除按钮
        $('.content-img-list').on('mouseover', '.content-img-list-item', function () {
            $(this).children('div').removeClass('hide');
        });
        // 鼠标离开隐藏删除按钮
        $('.content-img-list').on('mouseleave', '.content-img-list-item', function () {
            $(this).children('div').addClass('hide');
        });
        // 单个图片删除
        $(".content-img-list").on("click", '.content-img-list-item span .gcllajitong', function () {
            var index = $(this).parent().parent().parent().index();
            imgSrc.splice(index, 1);
            imgFile.splice(index, 1);
            imgName.splice(index, 1);
            var boxId = ".content-img-list";
            addNewContent(boxId);
            if (imgSrc.length < 1) { //显示上传按钮
                $('.content-img .file').show();
            } else {
                $('.content-img .file').hide();
            }
        });


        $(".content-img-list").on("click", '.content-img-list-item a .gclfangda', function () {
            var index = $(this).parent().parent().parent().index();
            $(".modal-content").html("");


        });


    });
    //图片上传
    $('#upload').on('change', function (e) {
        var imgSize = this.files[0].size;
        if (imgSize > 1024 * 500 * 1) { //1M
            return alert("上传图片不能超过500KB");
        }
        ;
        if (this.files[0].type != 'image/png' && this.files[0].type != 'image/jpeg' && this.files[0].type != 'image/gif') {
            return alert("图片上传格式不正确");
        }

        var imgBox = '.content-img-list';
        var fileList = this.files;
        for (var i = 0; i < fileList.length; i++) {
            var imgSrcI = getObjectURL(fileList[i]);
            imgName.push(fileList[i].name);
            imgSrc.push(imgSrcI);
            imgFile.push(fileList[i]);
        }
        addNewContent(imgBox);
        this.value = null; //上传相同图片

        console.log('imgSrc===', imgSrc)
        if (imgSrc.length < 1) { //显示上传按钮
            $('.content-img .file').show();
        } else {
            $('.content-img .file').hide();
        }
    });

    //提交请求
    $('#btn-submit-upload').on('click', function () {
        var formFile = new FormData();

        // 遍历图片imgFile添加到formFile里面
        $.each(imgFile, function (i, file) {
            formFile.append('myFile', file);
        });


    });

    //删除
    function removeImg(obj, index) {
        imgSrc.splice(index, 1);
        imgFile.splice(index, 1);
        imgName.splice(index, 1);
        var boxId = ".content-img-list";
        addNewContent(boxId);
    }

    //图片展示
    function addNewContent(obj) {
        $(obj).html("");
        for (var a = 0; a < imgSrc.length; a++) {
            var oldBox = $(obj).html();
            $(obj).html(oldBox + '<li class="content-img-list-item"><img src="' + imgSrc[a] + '" alt="">' +
                '<div><span index="' + a + '" class="delete-btn"><i class="gcl gcllajitong"></i></span>' +
                '</div></li>');
        }
    }

    //建立可存取到file的url
    function getObjectURL(file) {
        var url = null;
        if (window.createObjectURL != undefined) { // basic
            url = window.createObjectURL(file);
        } else if (window.URL != undefined) { // mozilla(firefox)
            url = window.URL.createObjectURL(file);
        } else if (window.webkitURL != undefined) { // webkit or chrome
            url = window.webkitURL.createObjectURL(file);
        }
        return url;
    }

</script>
</html>
